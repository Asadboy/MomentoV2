# Momento V1 — Road to App Store

**Date:** 2026-02-03
**Status:** Active
**Target submission:** Feb 10-12, 2026
**Target live date:** Feb 21, 2026
**Available hours:** ~105 hours (4hrs/day weekdays, 15hrs/day weekends)

**Reference docs:**
- Monetisation: `Docs/plans/2026-02-03-monetisation-v1.md`
- Database & Backend: `Docs/plans/2026-02-03-database-backend-v1.md`

---

## Current State

The core loop is complete. A user can create a Momento, invite friends, take photos, wait for the reveal, swipe through the feed, like and download photos. PostHog tracking is instrumented. The 5-table schema is in place with triggers.

### What's Built

- Event creation with auto-calculated timing (starts_at only, ends_at + release_at computed)
- Photo capture with offline support and background upload
- Full reveal feed (paginated, tap-to-reveal, likes, downloads)
- Liked gallery with batch download
- Event invites (QR code + join code + deep link)
- Profile with stats (events joined, photos taken, photos liked, user number)
- PostHog tracking (15 events across premium, virality, core loop)
- 5-table Supabase schema with DB triggers for member_count and photo_count
- Swift models migrated to new schema
- Web album (Next.js site at `/album/[code]` — functional with pagination, lightbox, downloads)
- Google Sign-In + Apple Sign-In

### What's Missing

The monetisation layer and a few features that turn the prototype into a product.

---

## What's Left — Ordered by Priority

Each item has clear "done" criteria so there's no ambiguity about when to move on.

### 1. Database: Add Missing Columns

**Why first:** Everything else depends on the schema being final.

Add three columns to the `events` table:
- `expires_at timestamptz` — for countdown UI and cleanup job
- `premium_purchased_at timestamptz` — audit trail
- `premium_transaction_id text` — RevenueCat receipt

Add the index:
- `idx_events_expires ON events(expires_at) WHERE expires_at IS NOT NULL`

Update `createEvent()` in SupabaseManager to set `expires_at = release_at + 30 days` on creation.

**Done when:** Columns exist in Supabase, SupabaseManager sets `expires_at` on event creation, EventModel includes the new fields.

---

### 2. Watermark on Free Downloads

**Why next:** This is the core of the free/premium split. Without it, there's no reason to buy premium.

Build a watermark renderer that composites a subtle Momento brand mark onto photos at download time. The watermark is applied in Swift when saving to camera roll — not baked into stored photos.

**Rules:**
- Applied when `event.isPremium == false`
- Classy and subtle — this is advertising, not punishment
- Same watermark everywhere, no variants
- Only on downloads, never on in-app viewing

**Done when:** Downloading a photo from a free event saves a watermarked version. Downloading from a premium event saves clean.

---

### 3. Share Button in Reveal Feed

**Why now:** Share functionality exists in the gallery but not on reveal cards. The reveal is when people most want to share.

Add a share button to `RevealCardView.swift` alongside the existing like and save buttons. Uses the native `UIActivityViewController` — same pattern as the gallery share.

**Done when:** Each reveal card has a share button that opens the iOS share sheet with the photo.

---

### 4. Expiry Countdown on Event Cards

**Why now:** Users need to see "This Momento fades in X days" from day one so the concept of permanence is established before anyone is asked to pay.

Display the countdown on the event card or event screen for free events that are in the revealed state. Calculate from `expires_at`.

**Done when:** Free revealed events show a countdown. Premium events don't.

---

### 5. Premium Prompt — End of Reveal Feed

**Why now:** This is your primary conversion point.

After the last photo in the reveal feed, show a final card with:
- Event stats (total likes, photo count, member count)
- "This Momento fades in X days"
- "Keep it forever — £7.99" CTA
- Dismiss option

Only shown to the host (`event.creatorId == currentUserId`).

**Done when:** Host sees the premium card as the final item in the reveal feed. Guests don't see it.

---

### 6. Premium Prompt — Event Screen Modal

**Why now:** Secondary conversion point.

When the host opens an event screen for a revealed, non-premium event, show a dismissible modal with the same messaging. Once per visit.

**Done when:** Host sees the modal once when visiting a revealed free event. Dismissing it doesn't show it again until the next visit. Guests never see it.

---

### 7. RevenueCat Integration

**Why here:** Now that the prompts exist, wire up the actual payment.

- Add RevenueCat SDK
- Configure a non-consumable product (£7.99 per event)
- Connect the CTA buttons from steps 5 and 6 to the RevenueCat paywall
- On purchase success: set `is_premium = true`, `expires_at = NULL` on the event
- Client-side optimistic update — the webhook (step 10) handles the real write

**Done when:** Host can tap "Keep it forever," pay through Apple, and the event is marked premium. Watermark disappears on subsequent downloads.

---

### 8. Web Album Link in App

**Why here:** Premium is now purchasable, so the web album benefit needs to be visible.

After an event is marked premium, show the web album link on the event screen:
- "Share this album" button
- Copies `https://yourmomento.app/album/{joinCode}` to clipboard or opens native share sheet

**Done when:** Premium event screen shows a shareable web album link. Free events don't.

---

### 9. Edge Function: Event Cleanup

**Why now:** The free tier auto-delete needs to actually work, even if the grace period is generous.

Supabase Edge Function on a daily cron:
1. Soft delete events where `expires_at < now()`
2. Separate pass: hard delete events that have been `is_deleted = true` for 24+ hours, remove photos from storage

**Done when:** Expired free events get soft deleted daily. Storage gets cleaned up.

---

### 10. Edge Function: RevenueCat Webhook

**Why now:** Server-side purchase verification.

Edge Function that receives RevenueCat webhook:
1. Verify signature
2. Set `is_premium = true`, `premium_purchased_at = now()`, `premium_transaction_id`, `expires_at = NULL`
3. Return 200

**Done when:** A purchase triggers the webhook, and the event is marked premium server-side.

---

### 11. Push Notifications (Reveal Ready)

**Not a ship blocker.** Your first users are friends — you'll be in the group chat telling them photos are ready. Build this when you have users you don't personally know.

When you do build it:
- Edge Function on cron checks `release_at <= now()` for events that haven't sent notifications
- Fetch `device_token` from profiles via `event_members`
- Send APNs push

**Deferring this does not block App Store submission.**

---

## What You Can Skip This Week

Be ruthless. Every hour spent on polish is an hour not spent submitting.

| Item | Why it can wait |
|------|----------------|
| Push notifications | Text your friends instead |
| PostHog dashboards | Events are already being tracked, build dashboards when you have data worth looking at |
| Smart engagement triggers | Simple prompt is enough for v1 |
| Web album UI polish | It works, don't touch it |
| Admin tooling | Supabase console is your admin panel |
| Error retry UI for failed uploads | The retry logic exists, users don't need to see it yet |
| Profile editing (avatar, display name) | Username is enough for launch |

### The Temptation

You will be tempted to polish things. To tweak the reveal animation. To add one more analytics event. To make the watermark "perfect." To redesign the event card before anyone's seen it.

Don't. Ship it. Your first 100 users don't care about pixel-perfect — they care that it works and that the reveal moment feels good. You've already built that part.

---

## App Store Submission Checklist

Things Apple requires that aren't feature work but will block you if you forget.

- [ ] **In-App Purchase configured early** — Set up the £7.99 non-consumable in App Store Connect at the start of the week. Apple reviews IAPs separately and it can take 24-48 hours. Don't let this be the bottleneck.
- [ ] **App Privacy labels** — Declare what data you collect (PostHog analytics, Supabase auth, photos). Fill this out in App Store Connect.
- [ ] **Privacy Policy URL** — You already have `/privacy` on the landing page. Make sure it's accurate and the URL is entered in App Store Connect.
- [ ] **App Review screenshots** — Minimum 3 screenshots per device size. Show the core loop: create → capture → reveal.
- [ ] **App description** — Short, clear. "Create a shared photo album. Take photos during the event. See them all revealed together 24 hours later."
- [ ] **Age rating** — Fill out the questionnaire in App Store Connect. Photo sharing with no user-generated text = straightforward.
- [ ] **Sign in with Apple works end-to-end** — Apple will test this during review. Make sure it doesn't crash.
- [ ] **Google Sign-In works** — Less scrutinised by Apple but should still work.
- [ ] **No placeholder UI** — Apple rejects apps with "coming soon" buttons or empty screens. Every button needs to do something.
- [ ] **Photo permission prompts** — Camera and Photo Library usage descriptions in Info.plist. Be specific: "Momento uses your camera to take photos during events."

---

## Order of Attack

Not a schedule — a sequence based on dependencies. With Claude handling implementation, you're directing and testing.

### Week 1 (Feb 3-9): Build the monetisation layer

**Monday-Tuesday: Foundation**
- Set up IAP in App Store Connect (start the clock on Apple's IAP review)
- Add `expires_at`, `premium_purchased_at`, `premium_transaction_id` columns to Supabase
- Update SupabaseManager + EventModel to include new fields
- Build watermark renderer

**Wednesday-Thursday: Premium UI**
- Add share button to reveal cards
- Build expiry countdown on event cards/screen
- Build premium prompt card (end of reveal feed)
- Build premium prompt modal (event screen revisit)

**Friday + Weekend: Payments & Backend**
- Integrate RevenueCat SDK
- Wire up premium prompts to RevenueCat paywall
- Test purchase flow end-to-end on device
- Surface web album link for premium events
- Deploy cleanup Edge Function
- Deploy RevenueCat webhook Edge Function

### Week 2 (Feb 10-12): Polish & Submit

**Monday-Tuesday: Final pass**
- Test every flow on physical device: create → invite → capture → reveal → like → download → premium purchase
- Test watermark appears on free, disappears on premium
- Test web album link only shows for premium
- Test expiry countdown shows correctly
- Fix any bugs from testing
- App Store screenshots and metadata
- Fill out privacy labels, age rating, description

**Wednesday: Submit**
- Final build
- Submit to App Store

### Week 2-3 (Feb 12-21): Review Buffer

This buffer exists because:
- First submissions often get rejected for minor issues (permission descriptions, screenshot guidelines, metadata)
- Apple's review queue is currently backed up
- IAP review is a separate process that can delay things
- You may need 2-3 submission attempts

If Apple rejects, fix the issue same day and resubmit. Most first-submission rejections are metadata issues, not code issues.

---

## The Only Question That Matters

Before you start any piece of work, ask yourself:

> "Does this block App Store submission?"

If no, it goes on the backlog. If yes, do it now. Items 1-10 above are yes. Everything in "What You Can Skip" is no. Stay focused.

---

## After V1 Ships

Once you're live, these become the next priorities. Each gets its own design doc when the time comes.

- Push notifications (reveal ready, someone joined)
- Switch auto-delete from 30 days to 7 days (when past early adopter phase)
- PostHog dashboards (conversion rate, reveal completion, growth loop)
- Smart engagement triggers for premium prompt
- Host curation for web albums
- Profile editing (avatar, display name)
- Premium timing controls (custom capture/reveal windows)
